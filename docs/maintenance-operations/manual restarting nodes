---
title: "Stopping and Manually Restarting a Storage Node"
weight: 500
---

There are a few reasons two restart a storage node:
- after a node became unavailable, the auto-restart did not work
- cluster upgrade
- planned node maintainance

!!! warning
    There is an auto-restart function, which restarts node in case the monitoring service detects
    an issue with the node. This can be the case if one of the containers exited or after a reboot 
    of the host or because of an internal node error, which causes the management interface to become 
    unresponsive. The auto-restart function retries multiple times. It will **not** work in one of 
    the following cases:
    - cluster is suspended (e.g. more than one node offline)
    - the RPC interface is responsive and the container is up, but the node has another health issue
    - host or docker service not available or hanging (e.g. network issue) 
    - too many retries (e.g. because there is a problem with the lvolstore recovering some of the lvols)
    In these cases, a manual restart is required.

## Shutdown of Storage Nodes

!!! warning
    Nodes can only be restarted from ***offline*** state!
    Make sure that cluster is not in ***degraded*** state and all other nodes are ***online*** 
    before shutting down a node for maintainance or upgrades!

Suspend the node and then shut it down: 

```bash title="Shutdown storage node"
{{ cliname }} storage-node suspend <NODE_ID> 
{{ cliname }} storage-node shutdown <NODE_ID> 
```   

If that does not work:

```bash title="Shutdown storage node forcefully"
{{ cliname }} storage-node shutdown <NODE_ID> --force
```
### Node in Offline Mode

It is very important to notice that with a node in offline mode, the cluster is in degraded state.
Write and read performance can be impacted and if another node goes offline, io will be interrupted.
Therefore it is recommended to keep nodes in offline mode as short as possible!

If you need a longer maintainance window (hours to days or weeks), it is recommended to migrate 
the node to a another host (this alternative host can be without nvme!). Node migration is entirely
automated. Later you can migrate it back.

### Restarting a storage node

```bash title="Restarting storage node"
{{ cliname }} storage-node restart <NODE_ID> 
```    

In the rare case the restart hangs, you need to (force) shutdown the storage node again and you can 
try to force-restart:

```bash title="Restarting storage node"
{{ cliname }} storage-node restart <NODE_ID> --force 
```   

### Restarting docker service

!!! info
    This applies to dis-aggregated storage nodes under docker (***non-k8s***) only. 
  
If there is a problem with the entire docker service on a host, the docker service may require a restart. 
In such a case, auto-restart cannot work, because the container responsible for auto-restarting (SNodeAPI) itself will not respond.

```bash title="Restarting docker service"
sudo systemctl restart docker --force
```  

After restarting the docker service, the auto-restart should restart the storage node after some time.
A manual restart of the storage node is not required.

